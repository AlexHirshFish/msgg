# Messenger - ะกะพะฒัะตะผะตะฝะฝัะน ะผะตััะตะฝะดะถะตั

ะกะพะฒัะตะผะตะฝะฝัะน ะผะตััะตะฝะดะถะตั ั ัะตะณะธัััะฐัะธะตะน ะฟะพ ัะตะปะตัะพะฝั, ะฟะพะดะดะตัะถะบะพะน Telegram-ะฐััะตะฝัะธัะธะบะฐัะธะธ ะธ VKUI ะธะฝัะตััะตะนัะพะผ.

## ๐ ะะพะทะผะพะถะฝะพััะธ

- โ ะะตะณะธัััะฐัะธั ะธ ะฒัะพะด ะฟะพ ัะตะปะตัะพะฝั/email
- โ ะะตัะธัะธะบะฐัะธั ัะตัะตะท SMS-ะบะพะดั
- โ ะััะตะฝัะธัะธะบะฐัะธั ัะตัะตะท Telegram
- โ ะะธัะฝัะต ัะฐัั
- โ ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั
- โ ะัะฟัะฐะฒะบะฐ ัะฐะนะปะพะฒ
- โ ะะพะฝัะฐะบัั
- โ ะะพะธัะบ ะฟะพ ะฝะพะผะตัั ัะตะปะตัะพะฝะฐ
- โ ะะฝัะตััะตะนั ะฝะฐ VKUI ะบะพะผะฟะพะฝะตะฝัะฐั
- โ Real-time ัะพะพะฑัะตะฝะธั (ัะตัะตะท WebSocket)

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- PHP 8.0+
- MySQL 5.7+
- Composer
- Node.js (ะดะปั ัะฐะทัะฐะฑะพัะบะธ ััะพะฝัะตะฝะดะฐ)

## ๐ ะฃััะฐะฝะพะฒะบะฐ

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone <ะฒะฐั-ัะตะฟะพะทะธัะพัะธะน>
cd messenger
```

### 2. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
composer install
```

### 3. ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั

ะกะบะพะฟะธััะนัะต ัะฐะนะป `.env.example` ะฒ `.env`:

```bash
cp .env.example .env
```

ะััะตะดะฐะบัะธััะนัะต `.env` ัะฐะนะป:

```env
# ะัะฝะพะฒะฝัะต ะฝะฐัััะพะนะบะธ
APP_NAME=Messenger
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

# ะะฐะทะฐ ะดะฐะฝะฝัั
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=messenger
DB_USERNAME=ะฒะฐั_ะฟะพะปัะทะพะฒะฐัะตะปั
DB_PASSWORD=ะฒะฐั_ะฟะฐัะพะปั

# Telegram ะฑะพั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
TELEGRAM_BOT_TOKEN=ะฒะฐั_ัะพะบะตะฝ
TELEGRAM_BOT_NAME=ะธะผั_ะฑะพัะฐ

# JWT ะฝะฐัััะพะนะบะธ
JWT_SECRET=ะฒะฐั_ัะตะบัะตัะฝัะน_ะบะปัั
JWT_EXPIRES_IN=86400

# ะฅัะฐะฝะธะปะธัะต ัะฐะนะปะพะฒ
STORAGE_PATH=/storage
MAX_FILE_SIZE=10485760
```

### 4. ะกะพะทะดะฐะฝะธะต ะฑะฐะทั ะดะฐะฝะฝัั

ะัะฟะพะปะฝะธัะต SQL ัะบัะธะฟั:

```bash
mysql -u ะฒะฐั_ะฟะพะปัะทะพะฒะฐัะตะปั -p ะฒะฐั_ะฟะฐัะพะปั < database/schema.sql
```

ะะปะธ ะฒัััะฝัั ัะพะทะดะฐะนัะต ะฑะฐะทั ะดะฐะฝะฝัั ะธ ะธะผะฟะพััะธััะนัะต ััะตะผั.

### 5. ะกะพะทะดะฐะฝะธะต ะดะธัะตะบัะพัะธะน ััะฐะฝะตะฝะธั

```
mkdir -p storage/voices storage/attachments
chmod -R 755 storage
```

## โถ๏ธ ะะฐะฟััะบ

### ะะตะถะธะผ ัะฐะทัะฐะฑะพัะบะธ

```bash
./start-dev.sh
```

ะะปะธ ะฒัััะฝัั:

```bash
php -S localhost:8000 -t .
```

### ะะพัััะฟ ะบ ะฟัะธะปะพะถะตะฝะธั

- **ะัะพะด/ะะตะณะธัััะฐัะธั**: http://localhost:8000/public/login.html
- **ะะตััะตะฝะดะถะตั**: http://localhost:8000/public/messenger.html
- **API**: http://localhost:8000/api/

## ๐ณ ะะตะฟะปะพะน ะฝะฐ Railway

### 1. ะะพะดะณะพัะพะฒะบะฐ ัะตะฟะพะทะธัะพัะธั

ะกะพะทะดะฐะนัะต ัะตะฟะพะทะธัะพัะธะน ะฝะฐ GitHub:

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/ะฒะฐั_ะปะพะณะธะฝ/messenger.git
git push -u origin main
```

### 2. ะะฐัััะพะนะบะฐ Railway

1. ะะฐัะตะณะธัััะธััะนัะตัั ะฝะฐ [Railway.app](https://railway.app)
2. ะกะพะทะดะฐะนัะต ะฝะพะฒัะน ะฟัะพะตะบั
3. ะะพะดะบะปััะธัะต GitHub ัะตะฟะพะทะธัะพัะธะน
4. ะะพะฑะฐะฒััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

```
APP_NAME=Messenger
APP_ENV=production
APP_DEBUG=false
APP_URL=https://ะฒะฐั_ะฟัะพะตะบั.up.railway.app

DB_CONNECTION=mysql
DB_HOST=ะฒะฐั_ัะพัั_mysql
DB_PORT=3306
DB_DATABASE=railway
DB_USERNAME=ะฒะฐั_ะฟะพะปัะทะพะฒะฐัะตะปั
DB_PASSWORD=ะฒะฐั_ะฟะฐัะพะปั

JWT_SECRET=ะฒะฐั_ัะตะบัะตัะฝัะน_ะบะปัั
JWT_EXPIRES_IN=86400
```

### 3. ะะพะฝัะธะณััะฐัะธั Railway

ะกะพะทะดะฐะนัะต ัะฐะนะป `railway.toml`:

```toml
[build]
builder = "nixpacks"

[deploy]
startCommand = "php -S 0.0.0.0:$PORT -t ."
```

### 4. ะะตะฟะปะพะน

Railway ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะดะตะฟะปะพะธั ะฟัะธะปะพะถะตะฝะธะต ะฟัะธ ะฟััะต ะฒ ัะตะฟะพะทะธัะพัะธะน.

## ๐ง ะะฝัะตะณัะฐัะธั Telegram

### 1. ะกะพะทะดะฐะฝะธะต ะฑะพัะฐ

1. ะะฐะฟะธัะธัะต [@BotFather](https://t.me/BotFather) ะฒ Telegram
2. ะกะพะทะดะฐะนัะต ะฝะพะฒะพะณะพ ะฑะพัะฐ ะบะพะผะฐะฝะดะพะน `/newbot`
3. ะะพะปััะธัะต ัะพะบะตะฝ ะฑะพัะฐ

### 2. ะะฐัััะพะนะบะฐ Webhook

```bash
curl -F "url=https://ะฒะฐั_ัะฐะนั/api/telegram/webhook.php" \
     https://api.telegram.org/botะะะจ_ะขะะะะ/setWebhook
```

### 3. ะะฐัััะพะนะบะฐ ะฒ .env

```env
TELEGRAM_BOT_TOKEN=ะฒะฐั_ัะพะบะตะฝ
TELEGRAM_BOT_NAME=ะธะผั_ะฑะพัะฐ
```

## ๐ฑ ะะฝัะตะณัะฐัะธั ั MAX ะผะตััะตะฝะดะถะตัะพะผ

ะะปั ะธะฝัะตะณัะฐัะธะธ ั MAX ะผะตััะตะฝะดะถะตัะพะผ ะฟะพััะตะฑัะตััั:

1. ะะพะปััะธัั API ะบะปัั ะพั MAX
2. ะะตะฐะปะธะทะพะฒะฐัั ะผะตัะพะดั ะพัะฟัะฐะฒะบะธ SMS ัะตัะตะท ะธั API
3. ะะฐะผะตะฝะธัั ะทะฐะณะปััะบั ะฒ `AuthService::sendVerificationCode()`

ะัะธะผะตั ะธะฝัะตะณัะฐัะธะธ:

```php
// includes/Services/SmsService.php
public static function sendMaxSms($phone, $code) {
    $apiKey = env('MAX_API_KEY');
    $response = Http::post('https://api.max.ru/sms/send', [
        'api_key' => $apiKey,
        'phone' => $phone,
        'message' => "ะะฐั ะบะพะด ะฟะพะดัะฒะตัะถะดะตะฝะธั: {$code}"
    ]);
    
    return $response->successful();
}
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
messenger/
โโโ api/                 # API endpoints
โ   โโโ auth.php        # ะััะตะฝัะธัะธะบะฐัะธั
โ   โโโ chats.php       # ะงะฐัั ะธ ัะพะพะฑัะตะฝะธั
โ   โโโ contacts.php    # ะะพะฝัะฐะบัั
โ   โโโ media.php       # ะะฐะณััะทะบะฐ ัะฐะนะปะพะฒ
โ   โโโ users.php       # ะะพะธัะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
โโโ bootstrap/          # Bootstrap ะฟัะธะปะพะถะตะฝะธั
โโโ config/             # ะะพะฝัะธะณััะฐัะธะธ
โโโ database/           # ะกัะตะผะฐ ะะ
โโโ includes/           # ะะปะฐััั ะธ ัะตัะฒะธัั
โ   โโโ Database/       # ะะฐะฑะพัะฐ ั ะะ
โ   โโโ Models/         # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โ   โโโ Chat.php
โ   โ   โโโ Contact.php
โ   โ   โโโ Message.php
โ   โ   โโโ User.php
โ   โโโ Services/       # ะกะตัะฒะธัั
โ       โโโ AuthService.php
โโโ public/             # ะัะฑะปะธัะฝัะต ัะฐะนะปั
โ   โโโ login.html      # ะกััะฐะฝะธัะฐ ะฒัะพะดะฐ
โ   โโโ messenger.html  # ะัะฝะพะฒะฝะพะน ะธะฝัะตััะตะนั
โโโ storage/            # ะฅัะฐะฝะธะปะธัะต ัะฐะนะปะพะฒ
โ   โโโ voices/         # ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั
โ   โโโ attachments/    # ะะปะพะถะตะฝะธั
โโโ websocket/          # WebSocket ัะตัะฒะตั
โโโ composer.json       # ะะฐะฒะธัะธะผะพััะธ PHP
โโโ .env.example        # ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ
โโโ .htaccess           # ะะพะฝัะธะณััะฐัะธั Apache
โโโ start-dev.sh        # ะกะบัะธะฟั ะทะฐะฟััะบะฐ ัะฐะทัะฐะฑะพัะบะธ
โโโ start-websocket.sh  # ะกะบัะธะฟั ะทะฐะฟััะบะฐ WebSocket
โโโ railway.toml        # ะะพะฝัะธะณััะฐัะธั Railway
โโโ docs/               # ะะพะบัะผะตะฝัะฐัะธั
    โโโ DEPLOYMENT_RAILWAY.md
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- ะัะต ะฟะฐัะพะปะธ ัะตัะธัััััั ั ะฟะพะผะพััั bcrypt
- ะัะฟะพะปัะทัะตััั JWT ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ
- ะะฐัะธัะฐ ะพั CSRF ะฐัะฐะบ
- ะะฐะปะธะดะฐัะธั ะฒัะตั ะฒัะพะดะฝัั ะดะฐะฝะฝัั
- HTTPS ัะตะบะพะผะตะฝะดัะตััั ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะปะธ ั ะฒะฐั ะฒะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั, ัะพะทะดะฐะนัะต issue ะฒ ัะตะฟะพะทะธัะพัะธะธ ะธะปะธ ัะฒัะถะธัะตัั ั ัะฐะทัะฐะฑะพััะธะบะพะผ.

## ๐ ะะธัะตะฝะทะธั

MIT License