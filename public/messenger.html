<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Messenger</title>
    
    <!-- VKUI CSS -->
    <link rel="stylesheet" href="https://unpkg.com/@vkontakte/vkui/dist/vkui.css">
    
    <style>
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 8px;
        }
        
        .message-sender {
            background-color: #2688eb;
            color: white;
            margin-left: auto;
        }
        
        .message-receiver {
            background-color: #f0f1f3;
            color: #000;
        }
        
        .voice-message {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background-color: #f0f1f3;
            border-radius: 18px;
            cursor: pointer;
        }
        
        .attachment-preview {
            max-width: 200px;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        .online-status {
            width: 12px;
            height: 12px;
            background-color: #4bb34b;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            bottom: 0;
            right: 0;
        }
        
        .typing-indicator {
            font-style: italic;
            color: #818c99;
            font-size: 14px;
            padding: 8px 16px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- VKUI - –∏—Å–ø–æ–ª—å–∑—É–µ–º UMD –≤–µ—Ä—Å–∏—é -->
    <script src="https://unpkg.com/@vkontakte/vkui@6.0.0/dist/vkui.umd.js"></script>

    <script type="text/babel">
        const { 
            AdaptivityProvider, 
            ConfigProvider, 
            AppRoot, 
            SplitLayout, 
            SplitCol, 
            SplitPane,
            View,
            Panel,
            PanelHeader,
            PanelHeaderBack,
            Group,
            List,
            Cell,
            Header,
            Div,
            SimpleCell,
            Avatar,
            Badge,
            IconButton,
            FixedLayout,
            HorizontalScroll,
            Tabs,
            Tab,
            Placeholder,
            Spinner,
            Button,
            Input,
            FormItem,
            FormLayout,
            Textarea,
            ModalRoot,
            ModalPage,
            ModalPageHeader,
            withModalRootContext
        } = VKUI;

        // –ü–æ–ª—É—á–∞–µ–º –∏–∫–æ–Ω–∫–∏ –∏–∑ VKUI
        const Icon28MessageOutline = VKUI.VKIcons?.Icon28MessageOutline || function() { return React.createElement('span', null, 'üí¨'); };
        const Icon28Users3Outline = VKUI.VKIcons?.Icon28Users3Outline || function() { return React.createElement('span', null, 'üë•'); };
        const Icon28SearchOutline = VKUI.VKIcons?.Icon28SearchOutline || function() { return React.createElement('span', null, 'üîç'); };
        const Icon28AddOutline = VKUI.VKIcons?.Icon28AddOutline || function() { return React.createElement('span', null, '‚ûï'); };
        const Icon28AttachOutline = VKUI.VKIcons?.Icon28AttachOutline || function() { return React.createElement('span', null, 'üìé'); };
        const Icon28MicrophoneOutline = VKUI.VKIcons?.Icon28MicrophoneOutline || function() { return React.createElement('span', null, 'üé§'); };
        const Icon28Send = VKUI.VKIcons?.Icon28Send || function() { return React.createElement('span', null, '‚û°Ô∏è'); };
        const Icon28MoreHorizontal = VKUI.VKIcons?.Icon28MoreHorizontal || function() { return React.createElement('span', null, '‚ãÆ'); };
        const Icon24Chevron = VKUI.VKIcons?.Icon24Chevron || function() { return React.createElement('span', null, '‚ñ∂'); };

        class MessengerApp extends React.Component {
            constructor(props) {
                super(props);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
                const token = localStorage.getItem('token');
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                
                this.state = {
                    activeView: token ? 'chats' : 'login',
                    currentUser: user,
                    token: token,
                    chats: [],
                    contacts: [],
                    messages: {},
                    currentChatId: null,
                    newMessage: '',
                    isRecording: false,
                    recordingTime: 0,
                    modal: null,
                    isLoading: false,
                    searchQuery: '',
                    activeTab: 'chats',
                    searchResults: []
                };
                
                if (token) {
                    this.loadChats();
                    this.loadContacts();
                } else {
                    window.location.href = 'login.html';
                }
            }

            loadChats = async () => {
                this.setState({ isLoading: true });
                
                try {
                    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç API –≤—ã–∑–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤
                    // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const response = await fetch('/api/chats.php?action=get_chats', {
                        headers: {
                            'Authorization': `Bearer ${this.state.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.setState({ chats: data.chats });
                    }
                } catch (error) {
                    console.error('Error loading chats:', error);
                    
                    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏
                    const chats = [
                        {
                            id: 1,
                            name: '–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤',
                            avatar: 'https://sun9-71.userapi.com/s/v1/if1/NVdDJiBmK4J8mjiKz7wEeN7tX8Q9r0Y1.jpg',
                            lastMessage: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                            time: '14:30',
                            unread: 2,
                            online: true
                        },
                        {
                            id: 2,
                            name: '–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞',
                            avatar: 'https://sun9-59.userapi.com/s/v1/if1/9Y8aBcDeFgHiJkLmNoPqRsTuVwXyZ123.jpg',
                            lastMessage: '–û—Ç–ø—Ä–∞–≤–∏–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã',
                            time: '12:15',
                            unread: 0,
                            online: false
                        }
                    ];
                    
                    this.setState({ chats });
                } finally {
                    this.setState({ isLoading: false });
                }
            };

            loadContacts = async () => {
                try {
                    const response = await fetch('/api/contacts.php?action=get_contacts', {
                        headers: {
                            'Authorization': `Bearer ${this.state.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.setState({ contacts: data.contacts });
                    }
                } catch (error) {
                    console.error('Error loading contacts:', error);
                    
                    // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    const contacts = [
                        {
                            id: 1,
                            first_name: '–ê–ª–µ–∫—Å–µ–π',
                            last_name: '–ü–µ—Ç—Ä–æ–≤',
                            phone: '+7 999 123-45-67',
                            avatar: 'https://sun9-71.userapi.com/s/v1/if1/NVdDJiBmK4J8mjiKz7wEeN7tX8Q9r0Y1.jpg'
                        },
                        {
                            id: 2,
                            first_name: '–ú–∞—Ä–∏—è',
                            last_name: '–ò–≤–∞–Ω–æ–≤–∞',
                            phone: '+7 999 765-43-21',
                            avatar: 'https://sun9-59.userapi.com/s/v1/if1/9Y8aBcDeFgHiJkLmNoPqRsTuVwXyZ123.jpg'
                        }
                    ];
                    
                    this.setState({ contacts });
                }
            };

            loadMessages = async (chatId) => {
                try {
                    const response = await fetch(`/api/chats.php?action=get_messages&chat_id=${chatId}`, {
                        headers: {
                            'Authorization': `Bearer ${this.state.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.setState(prevState => ({
                            messages: {
                                ...prevState.messages,
                                [chatId]: data.messages
                            }
                        }));
                    }
                } catch (error) {
                    console.error('Error loading messages:', error);
                    
                    // –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    const messages = [
                        {
                            id: 1,
                            sender_id: 2,
                            content: '–ü—Ä–∏–≤–µ—Ç!',
                            type: 'text',
                            created_at: '2024-01-01 14:30:00'
                        },
                        {
                            id: 2,
                            sender_id: this.state.currentUser.id,
                            content: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                            type: 'text',
                            created_at: '2024-01-01 14:31:00'
                        }
                    ];
                    
                    this.setState(prevState => ({
                        messages: {
                            ...prevState.messages,
                            [chatId]: messages
                        }
                    }));
                }
            };

            sendMessage = async () => {
                if (!this.state.newMessage.trim() || !this.state.currentChatId) return;
                
                const message = {
                    id: Date.now(),
                    sender_id: this.state.currentUser.id,
                    content: this.state.newMessage,
                    type: 'text',
                    created_at: new Date().toISOString()
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç
                this.setState(prevState => ({
                    messages: {
                        ...prevState.messages,
                        [prevState.currentChatId]: [
                            ...(prevState.messages[prevState.currentChatId] || []),
                            message
                        ]
                    },
                    newMessage: ''
                }));
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                try {
                    const response = await fetch('/api/chats.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.state.token}`
                        },
                        body: JSON.stringify({
                            action: 'send_message',
                            chat_id: this.state.currentChatId,
                            content: message.content,
                            type: 'text'
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Å–µ—Ä–≤–µ—Ä–∞
                        const updatedMessages = this.state.messages[this.state.currentChatId].map(msg => 
                            msg.id === message.id ? data.message : msg
                        );
                        
                        this.setState(prevState => ({
                            messages: {
                                ...prevState.messages,
                                [prevState.currentChatId]: updatedMessages
                            }
                        }));
                    }
                } catch (error) {
                    console.error('Error sending message:', error);
                }
            };

            startRecording = () => {
                this.setState({ isRecording: true, recordingTime: 0 });
                
                // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø–∏—Å–∏
                this.recordingInterval = setInterval(() => {
                    this.setState(prevState => ({
                        recordingTime: prevState.recordingTime + 1
                    }));
                }, 1000);
            };

            stopRecording = () => {
                clearInterval(this.recordingInterval);
                this.setState({ isRecording: false, recordingTime: 0 });
                
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            };

            formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            openChat = (chatId) => {
                this.setState({ currentChatId: chatId });
                this.loadMessages(chatId);
            };

            logout = () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            };

            renderChatsList = () => (
                <Group>
                    {this.state.chats.map(chat => (
                        <SimpleCell
                            key={chat.id}
                            before={
                                <div style={{ position: 'relative' }}>
                                    <Avatar src={chat.avatar} size={48} />
                                    {chat.online && <div className="online-status"></div>}
                                </div>
                            }
                            after={
                                <>
                                    <Div style={{ color: '#818c99', fontSize: '13px' }}>
                                        {chat.time}
                                    </Div>
                                    {chat.unread > 0 && (
                                        <Badge mode="prominent">{chat.unread}</Badge>
                                    )}
                                </>
                            }
                            subtitle={chat.lastMessage}
                            onClick={() => this.openChat(chat.id)}
                        >
                            {chat.name}
                        </SimpleCell>
                    ))}
                </Group>
            );

            renderContactsList = () => (
                <Group>
                    {this.state.contacts.map(contact => (
                        <SimpleCell
                            key={contact.id}
                            before={<Avatar src={contact.avatar} size={48} />}
                            after={React.createElement(Icon24Chevron)}
                            onClick={() => this.openChat(contact.id)}
                        >
                            {`${contact.first_name} ${contact.last_name}`}
                            <Div style={{ color: '#818c99', fontSize: '13px' }}>
                                {contact.phone}
                            </Div>
                        </SimpleCell>
                    ))}
                </Group>
            );

            renderMessages = () => {
                const messages = this.state.messages[this.state.currentChatId] || [];
                
                return (
                    <Group>
                        <Div style={{ minHeight: 'calc(100vh - 200px)' }}>
                            {messages.map(message => (
                                <div
                                    key={message.id}
                                    className={`message-bubble ${
                                        message.sender_id === this.state.currentUser.id 
                                            ? 'message-sender' 
                                            : 'message-receiver'
                                    }`}
                                    style={{
                                        marginLeft: message.sender_id === this.state.currentUser.id ? 'auto' : 0,
                                        marginRight: message.sender_id !== this.state.currentUser.id ? 'auto' : 0
                                    }}
                                >
                                    {message.content}
                                    <div style={{ 
                                        fontSize: '11px', 
                                        opacity: 0.7, 
                                        marginTop: '4px',
                                        textAlign: message.sender_id === this.state.currentUser.id ? 'right' : 'left'
                                    }}>
                                        {new Date(message.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                    </div>
                                </div>
                            ))}
                            
                            {this.state.isRecording && (
                                <Div className="typing-indicator">
                                    üé§ –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è... {this.formatTime(this.state.recordingTime)}
                                </Div>
                            )}
                        </Div>
                        
                        <FixedLayout vertical="bottom">
                            <Div style={{ backgroundColor: 'white', padding: '8px' }}>
                                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                                    <IconButton>
                                        {React.createElement(Icon28AttachOutline)}
                                    </IconButton>
                                    
                                    {this.state.isRecording ? (
                                        <Button
                                            mode="destructive"
                                            size="l"
                                            stretched
                                            onClick={this.stopRecording}
                                        >
                                            –û—Ç–º–µ–Ω–∏—Ç—å
                                        </Button>
                                    ) : (
                                        <Textarea
                                            value={this.state.newMessage}
                                            onChange={(e) => this.setState({ newMessage: e.target.value })}
                                            placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
                                            onKeyDown={(e) => {
                                                if (e.key === 'Enter' && !e.shiftKey) {
                                                    e.preventDefault();
                                                    this.sendMessage();
                                                }
                                            }}
                                        />
                                    )}
                                    
                                    <IconButton
                                        onClick={this.state.isRecording ? this.stopRecording : this.startRecording}
                                    >
                                        {React.createElement(Icon28MicrophoneOutline, {
                                            style: { 
                                                color: this.state.isRecording ? '#e64646' : '#2688eb' 
                                            }
                                        })}
                                    </IconButton>
                                    
                                    {!this.state.isRecording && (
                                        <IconButton 
                                            disabled={!this.state.newMessage.trim()}
                                            onClick={this.sendMessage}
                                        >
                                            {React.createElement(Icon28Send)}
                                        </IconButton>
                                    )}
                                </div>
                            </Div>
                        </FixedLayout>
                    </Group>
                );
            };

            renderSearchUsers = () => (
                <Group>
                    <Div>
                        <Button 
                            size="l" 
                            mode="tertiary" 
                            onClick={() => this.setState({ activeView: 'chats', activeTab: 'contacts' })}
                        >
                            –ù–∞–∑–∞–¥
                        </Button>
                    </Div>
                    
                    <FormItem top="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
                        <Input
                            type="tel"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
                            value={this.state.searchQuery}
                            onChange={(e) => this.setState({ searchQuery: e.target.value })}
                            after={
                                <Button
                                    mode="tertiary"
                                    onClick={async () => {
                                        await this.searchUsersByPhone(this.state.searchQuery);
                                        this.setState({ activeView: 'search_users' });
                                    }}
                                >
                                    –ù–∞–π—Ç–∏
                                </Button>
                            }
                        />
                    </FormItem>
                    
                    <FormItem top="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞">
                        {this.state.searchResults && this.state.searchResults.length > 0 ? (
                            this.state.searchResults.map(user => (
                                <SimpleCell
                                    key={user.id}
                                    before={<Avatar src={user.avatar} size={48} />}
                                    after={
                                        <Button
                                            mode="primary"
                                            size="s"
                                            onClick={() => this.addContact(user.id)}
                                        >
                                            –î–æ–±–∞–≤–∏—Ç—å
                                        </Button>
                                    }
                                >
                                    {`${user.first_name} ${user.last_name}`}
                                    <Div style={{ color: '#818c99', fontSize: '13px' }}>
                                        {user.phone}
                                    </Div>
                                </SimpleCell>
                            ))
                        ) : (
                            <Div style={{ textAlign: 'center', color: '#818c99' }}>
                                –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
                            </Div>
                        )}
                    </FormItem>
                </Group>
            );

            searchUsersByPhone = async (phone) => {
                this.setState({ isLoading: true });
                
                try {
                    const response = await fetch(`/api/users.php?action=search_by_phone&phone=${encodeURIComponent(phone)}`, {
                        headers: {
                            'Authorization': `Bearer ${this.state.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.setState({ searchResults: data.users });
                        return data.users;
                    } else {
                        console.error('Error searching users:', data.error);
                        this.setState({ searchResults: [] });
                        return [];
                    }
                } catch (error) {
                    console.error('Error searching users:', error);
                    this.setState({ searchResults: [] });
                    return [];
                } finally {
                    this.setState({ isLoading: false });
                }
            };

            addContact = async (userId) => {
                try {
                    const response = await fetch('/api/contacts.php?action=add_contact', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.state.token}`
                        },
                        body: JSON.stringify({
                            contact_user_id: userId
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('–ö–æ–Ω—Ç–∞–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
                        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
                        this.loadContacts();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + data.error);
                    }
                } catch (error) {
                    console.error('Error adding contact:', error);
                    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞');
                }
            };

            render() {
                return (
                    <ConfigProvider>
                        <AdaptivityProvider>
                            <AppRoot>
                                <SplitLayout
                                    header={<PanelHeader separator={false} />}
                                    style={{ justifyContent: 'center' }}
                                >
                                    <SplitCol minWidth={320} width="100%" maxWidth={480}>
                                        {this.state.currentChatId ? (
                                            <View activePanel="messages">
                                                <Panel id="messages">
                                                    <PanelHeader
                                                        before={
                                                            React.createElement(PanelHeaderBack, {
                                                                onClick: () => this.setState({ currentChatId: null })
                                                            })
                                                        }
                                                        after={
                                                            <IconButton onClick={() => this.logout()}>
                                                                {React.createElement(Icon28MoreHorizontal)}
                                                            </IconButton>
                                                        }
                                                    >
                                                        –ß–∞—Ç
                                                    </PanelHeader>
                                                    {this.renderMessages()}
                                                </Panel>
                                            </View>
                                        ) : (
                                            <View activePanel={this.state.activeView}>
                                                <Panel id="chats">
                                                    <PanelHeader
                                                        before={
                                                            <IconButton onClick={() => this.logout()}>
                                                                {React.createElement(Icon28MoreHorizontal)}
                                                            </IconButton>
                                                        }
                                                    >
                                                        Messenger
                                                    </PanelHeader>
                                                    
                                                    <Tabs>
                                                        <Tab
                                                            selected={this.state.activeTab === 'chats'}
                                                            onClick={() => this.setState({ activeTab: 'chats' })}
                                                        >
                                                            {React.createElement(Icon28MessageOutline)}
                                                            –ß–∞—Ç—ã
                                                        </Tab>
                                                        <Tab
                                                            selected={this.state.activeTab === 'contacts'}
                                                            onClick={() => this.setState({ activeTab: 'contacts' })}
                                                        >
                                                            {React.createElement(Icon28Users3Outline)}
                                                            –ö–æ–Ω—Ç–∞–∫—Ç—ã
                                                        </Tab>
                                                    </Tabs>
                                                    
                                                    {this.state.isLoading ? (
                                                        <Div style={{ display: 'flex', justifyContent: 'center', padding: '20px' }}>
                                                            <Spinner size="large" />
                                                        </Div>
                                                    ) : this.state.activeTab === 'chats' ? (
                                                        this.renderChatsList()
                                                    ) : (
                                                        <Group>
                                                            <Div>
                                                                <Button 
                                                                    size="l" 
                                                                    mode="secondary" 
                                                                    stretched
                                                                    onClick={() => this.setState({ activeView: 'search_users' })}
                                                                >
                                                                    –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                                                                </Button>
                                                            </Div>
                                                            {this.renderContactsList()}
                                                        </Group>
                                                    )}
                                                </Panel>
                                                
                                                <Panel id="search_users">
                                                    <PanelHeader
                                                        before={
                                                            React.createElement(PanelHeaderBack, {
                                                                onClick: () => this.setState({ activeView: 'chats', activeTab: 'contacts' })
                                                            })
                                                        }
                                                    >
                                                        –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                                                    </PanelHeader>
                                                    {this.renderSearchUsers()}
                                                </Panel>
                                            </View>
                                        )}
                                    </SplitCol>
                                </SplitLayout>
                                
                                <ModalRoot activeModal={this.state.modal}>
                                    {/* –ó–¥–µ—Å—å –±—É–¥—É—Ç –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */}
                                </ModalRoot>
                            </AppRoot>
                        </AdaptivityProvider>
                    </ConfigProvider>
                );
            }
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(MessengerApp));
    </script>
</body>
</html>